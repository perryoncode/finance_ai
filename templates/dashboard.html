{% extends "base.html" %}
{% block title %}Dashboard · Finance AI{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="h3 mb-1 text-light">Dashboard</h2>
    <p class="text-muted mb-0 small">Signed in as {{ user.email }}</p>
  </div>
  <a href="{{ url_for('chat.chat_page') }}" class="btn btn-primary btn-sm">Open AI Assistant</a>
</div>

<div class="row g-3 mb-4">
  <div class="col-12 col-md-6">
    <div class="card bg-dark text-light h-100 border-secondary">
      <div class="card-body">
        <h5 class="card-title mb-2">Recent Income</h5>
        <p class="display-6 fw-semibold m-0">₹{{ '%.0f'|format(income) }}</p>
      </div>
    </div>
  </div>
  <div class="col-12 col-md-6">
    <div class="card bg-dark text-light h-100 border-secondary">
      <div class="card-body">
        <h5 class="card-title mb-2">Recent Expense</h5>
        <p class="display-6 fw-semibold m-0">₹{{ '%.0f'|format(expense) }}</p>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-12 col-lg-6">
    <div class="card bg-dark text-light border-secondary">
      <div class="card-body">
        <h5 class="card-title">Upload Transactions</h5>
        <form method="post" action="{{ url_for('dashboard.upload_csv') }}" enctype="multipart/form-data" class="mt-3">
          <div class="input-group">
            <input type="file" name="file" accept=".csv" required class="form-control form-control-sm bg-dark text-light border-secondary">
            <button type="submit" class="btn btn-primary btn-sm">Import</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="col-12 col-lg-6">
    <div class="card bg-dark text-light border-secondary">
      <div class="card-body">
        <h5 class="card-title">Upload Budgets</h5>
        <form method="post" action="{{ url_for('dashboard.upload_budget_csv') }}" enctype="multipart/form-data" class="mt-3">
          <div class="input-group">
            <input type="file" name="file" accept=".csv" required class="form-control form-control-sm bg-dark text-light border-secondary">
            <button type="submit" class="btn btn-primary btn-sm">Import</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="row g-3 mb-4">
  <div class="col-12 col-xl-7">
    <div class="card bg-dark text-light border-secondary">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="card-title mb-0">Recent Transactions</h5>
          <small class="text-muted">Showing latest {{ txs|length }} entries</small>
        </div>
        <div class="table-responsive" style="max-height:400px;">
          <table class="table table-dark table-striped table-hover table-sm align-middle mb-0">
            <thead>
              <tr class="text-muted">
                <th scope="col">Date</th>
                <th scope="col">Category</th>
                <th scope="col">Type</th>
                <th scope="col" class="text-end">Amount</th>
                <th scope="col">Description</th>
              </tr>
            </thead>
            <tbody>
              {% for t in txs %}
              <tr>
                <td class="small">{{ t.date }}</td>
                <td class="small">{{ t.categories.name if t.categories }}</td>
                <td class="small text-capitalize">{{ t.type }}</td>
                <td class="small text-end">₹{{ '%.0f'|format(t.amount) }}</td>
                <td class="small">{{ t.description }}</td>
              </tr>
              {% endfor %}
              {% if txs|length == 0 %}
              <tr><td colspan="5" class="text-center text-muted small">No transactions imported yet.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <div class="col-12 col-xl-5">
    <div class="card bg-dark text-light border-secondary h-100">
      <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <h5 class="card-title mb-0">Expected Budget</h5>
          <small class="text-muted">Latest {{ bjs|length }} categories</small>
        </div>
        <div class="table-responsive" style="max-height:400px;">
          <table class="table table-dark table-striped table-hover table-sm align-middle mb-0">
            <thead>
              <tr class="text-muted">
                <th scope="col">Category</th>
                <th scope="col" class="text-end">Budget</th>
                <th scope="col">Month</th>
              </tr>
            </thead>
            <tbody>
              {% for b in bjs %}
              <tr>
                <td class="small">{{ b.categories.name }}</td>
                <td class="small text-end">₹{{ '%.0f'|format(b.amount) }}</td>
                <td class="small">{{ b.month }}</td>
              </tr>
              {% endfor %}
              {% if bjs|length == 0 %}
              <tr><td colspan="3" class="text-center text-muted small">No budgets imported yet.</td></tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}
